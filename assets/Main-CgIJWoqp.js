import{r,j as e,u as V,a as A}from"./index-CHZHm0gm.js";import{u as O,a as R}from"./infinityScrollHook-BOzMlaHF.js";import{g as F}from"./localeStorageApi-BzC0sAnb.js";import{p as H,g as x,a as M}from"./registerAndLogin-srQY7G39.js";import{u as q,v as U}from"./LikeHook-DBmL0K7U.js";import{L as $}from"./Spinner-DFVUat-t.js";import"./firebase-CLNeqrfC.js";const J="_search_1o9ft_1",X="_meta_1o9ft_39",Y="_post_1o9ft_69",z="_postWrapper_1o9ft_77",G="_feedback_1o9ft_123",K="_imgWrap_1o9ft_151",Q="_modalOverlay_1o9ft_169",T="_modalContent_1o9ft_195",Z="_commentBox_1o9ft_215",ee="_modalButtons_1o9ft_235",te="_sendBtn_1o9ft_247",se="_closeBtn_1o9ft_273",a={search:J,meta:X,post:Y,postWrapper:z,feedback:G,imgWrap:K,modalOverlay:Q,modalContent:T,commentBox:Z,modalButtons:ee,sendBtn:te,closeBtn:se};function ae(l,i){return e.jsx(e.Fragment,{children:e.jsxs("section",{id:"search",className:a.search,children:[e.jsx("h3",{children:"What do you need?"}),e.jsx("input",{type:"search",ref:i,name:"search",id:"search",placeholder:"search"}),e.jsx("button",{onClick:l.onSearch,children:"ðŸ”"})]})})}const ne=r.forwardRef(ae);function oe(){const l=V();return{handleDetailsClick:o=>{l(`/react-regular-exam/welcome/${o}/details`,{state:{postId:o}})}}}function ce(){return{handleView:async i=>{try{await H(i)}catch(o){alert("Error adding like: "+o.message)}}}}function pe(){const[l,i]=r.useState([]),[o,d]=r.useState([]),u=r.useRef(),{fetchPosts:y,loadMorePosts:j,loading:_,handleSearch:k}=O(),{mainRef:C}=A(),{handleDetailsClick:v}=oe(),{handleView:N}=ce(),{handleLike:B}=q(),[b,h]=r.useState(!1),[w,p]=r.useState(0),f=async t=>{const n=t.target.closest("#closestID").getAttribute("data-key");await N(n),v(n)};r.useEffect(()=>{h(!0),(async()=>{await y(i,d),h(!1)})()},[w]);const E=()=>{u.current&&k(u.current.value,d,l)};R(C,()=>j(l,o,d));const I=t=>{const n=t.target.closest("#closestID").getAttribute("data-key"),c=document.getElementById(n);c.style.display="block"},S=t=>{const n=t.target.closest("#closestID").getAttribute("data-key"),c=document.getElementById(n);c.style.display="none"},D=async t=>{const s=t.target.closest("#closestID"),n=s.getAttribute("data-key"),c=JSON.parse(F()),m={id:U(),author:c.name,text:s.querySelector("textarea").value,date:new Date().toLocaleString()};if(s.querySelector("textarea").value="",!m.text)return alert("Your reply is empty!");await M(n,m);const W=document.getElementById(n);W.style.display="none";const g=await x();g&&(d(g),p(L=>L+1))},P=async t=>{const n=t.target.closest("#closestID").getAttribute("data-key");await B(n);const c=await x();c&&(d(c),p(m=>m+1))};return e.jsxs(e.Fragment,{children:[e.jsx(ne,{ref:u,onSearch:E}),b&&e.jsx($,{}),e.jsx("section",{id:"posts",className:a.posts,children:o.length>0?o.map(t=>e.jsxs("div",{id:"closestID","data-key":t.id,className:a.postWrapper,children:[e.jsx("div",{onClick:s=>f(s),className:a.post,children:e.jsxs("div",{className:a.imgWrap,children:[e.jsxs("div",{className:a.meta,children:[e.jsx("img",{src:t.meta.profileImg?t.meta.profileImg:"https://png.pngtree.com/png-clipart/20210915/ourmid/pngtree-user-avatar-placeholder-png-image_3918418.jpg",alt:"Profile"}),e.jsx("h4",{children:t.meta.author}),e.jsx("p",{children:t.meta.date})]}),e.jsx("p",{children:t.content}),t.img&&e.jsx("img",{src:t.img,alt:""})]})},t.id),e.jsxs("div",{className:a.feedback,children:[e.jsxs("p",{onClick:s=>I(s),children:[e.jsx("i",{className:"fa-regular fa-comment"}),e.jsx("span",{children:t.feedback.comments})]}),e.jsxs("p",{onClick:s=>P(s),children:[e.jsx("i",{className:"fa-regular fa-heart"}),e.jsx("span",{children:t.feedback.likes})]}),e.jsxs("p",{onClick:s=>f(s),children:[e.jsx("i",{className:"fa-solid fa-magnifying-glass"}),e.jsx("span",{children:t.feedback.views})]})]}),e.jsx("div",{"data-key":t.id,id:t.id,style:{display:"none"},className:a.modalOverlay,children:e.jsxs("div",{className:a.modalContent,onClick:s=>s.stopPropagation(),children:[e.jsx("textarea",{className:a.commentBox,placeholder:"Post your reply"}),e.jsxs("div",{className:a.modalButtons,children:[e.jsx("button",{className:a.sendBtn,onClick:s=>D(s),children:"Reply"}),e.jsx("button",{className:a.closeBtn,onClick:s=>S(s),children:"X"})]})]})})]},t.id)):e.jsx("p",{children:"No posts found"})}),_&&e.jsx("p",{className:a.loading,children:"Loading more posts..."})]})}export{pe as default};
