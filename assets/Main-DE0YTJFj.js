import{r as i,j as e,u as P,a as W}from"./index-Mvt38fkz.js";import{u as L,a as V}from"./infinityScrollHook-DbAgg_1w.js";import{g as A}from"./localeStorageApi-BzC0sAnb.js";import{p as O,g,a as R}from"./registerAndLogin-srQY7G39.js";import{u as F,v as H}from"./LikeHook-DBmL0K7U.js";import{L as M}from"./Spinner-COAx2Mog.js";import"./firebase-CLNeqrfC.js";const q="_search_1o9ft_1",U="_meta_1o9ft_39",$="_post_1o9ft_69",J="_postWrapper_1o9ft_77",X="_feedback_1o9ft_123",Y="_imgWrap_1o9ft_151",z="_modalOverlay_1o9ft_169",G="_modalContent_1o9ft_195",K="_commentBox_1o9ft_215",Q="_modalButtons_1o9ft_235",T="_sendBtn_1o9ft_247",Z="_closeBtn_1o9ft_273",a={search:q,meta:U,post:$,postWrapper:J,feedback:X,imgWrap:Y,modalOverlay:z,modalContent:G,commentBox:K,modalButtons:Q,sendBtn:T,closeBtn:Z};function ee(l,r){return e.jsx(e.Fragment,{children:e.jsxs("section",{id:"search",className:a.search,children:[e.jsx("h3",{children:"What do you need?"}),e.jsx("input",{type:"search",ref:r,name:"search",id:"search",placeholder:"search"}),e.jsx("button",{onClick:l.onSearch,children:"🔍"})]})})}const te=i.forwardRef(ee);function se(){const l=P();return{handleDetailsClick:o=>{l(`/react-regular-exam/welcome/${o}/details`,{state:{postId:o}})}}}function ae(){return{handleView:async r=>{try{await O(r)}catch(o){alert("Error adding like: "+o.message)}}}}function me(){const[l,r]=i.useState([]),[o,d]=i.useState([]),m=i.useRef(),{fetchPosts:x,loadMorePosts:y,loading:j,handleSearch:_}=L(),{mainRef:k}=W(),{handleDetailsClick:C}=se(),{handleView:v}=ae(),{handleLike:N}=F(),[B,u]=i.useState(!1),h=async t=>{const n=t.target.closest("#closestID").getAttribute("data-key");await v(n),C(n)};i.useEffect(()=>{u(!0),(async()=>{await x(r,d),u(!1)})()},[]);const b=()=>{m.current&&_(m.current.value,d,l)};V(k,()=>y(l,o,d));const w=t=>{const n=t.target.closest("#closestID").getAttribute("data-key"),c=document.getElementById(n);c.style.display="block"},E=t=>{const n=t.target.closest("#closestID").getAttribute("data-key"),c=document.getElementById(n);c.style.display="none"},I=async t=>{const s=t.target.closest("#closestID"),n=s.getAttribute("data-key"),c=JSON.parse(A()),p={id:H(),author:c.name,text:s.querySelector("textarea").value,date:new Date().toLocaleString()};if(s.querySelector("textarea").value="",!p.text)return alert("Your reply is empty!");await R(n,p);const D=document.getElementById(n);D.style.display="none";const f=await g();f&&d(f)},S=async t=>{const n=t.target.closest("#closestID").getAttribute("data-key");await N(n);const c=await g();c&&d(c)};return e.jsxs(e.Fragment,{children:[e.jsx(te,{ref:m,onSearch:b}),B&&e.jsx(M,{}),e.jsx("section",{id:"posts",className:a.posts,children:o.length>0?o.map(t=>e.jsxs("div",{id:"closestID","data-key":t.id,className:a.postWrapper,children:[e.jsx("div",{onClick:s=>h(s),className:a.post,children:e.jsxs("div",{className:a.imgWrap,children:[e.jsxs("div",{className:a.meta,children:[e.jsx("img",{src:t.meta.profileImg?t.meta.profileImg:"https://png.pngtree.com/png-clipart/20210915/ourmid/pngtree-user-avatar-placeholder-png-image_3918418.jpg",alt:"Profile"}),e.jsx("h4",{children:t.meta.author}),e.jsx("p",{children:t.meta.date})]}),e.jsx("p",{children:t.content}),t.img&&e.jsx("img",{src:t.img,alt:""})]})},t.id),e.jsxs("div",{className:a.feedback,children:[e.jsxs("p",{onClick:s=>w(s),children:[e.jsx("i",{className:"fa-regular fa-comment"}),e.jsx("span",{children:t.feedback.comments})]}),e.jsxs("p",{onClick:s=>S(s),children:[e.jsx("i",{className:"fa-regular fa-heart"}),e.jsx("span",{children:t.feedback.likes})]}),e.jsxs("p",{onClick:s=>h(s),children:[e.jsx("i",{className:"fa-solid fa-magnifying-glass"}),e.jsx("span",{children:t.feedback.views})]})]}),e.jsx("div",{"data-key":t.id,id:t.id,style:{display:"none"},className:a.modalOverlay,children:e.jsxs("div",{className:a.modalContent,onClick:s=>s.stopPropagation(),children:[e.jsx("textarea",{className:a.commentBox,placeholder:"Post your reply"}),e.jsxs("div",{className:a.modalButtons,children:[e.jsx("button",{className:a.sendBtn,onClick:s=>I(s),children:"Reply"}),e.jsx("button",{className:a.closeBtn,onClick:s=>E(s),children:"X"})]})]})})]},t.id)):e.jsx("p",{children:"No posts found"})}),j&&e.jsx("p",{className:a.loading,children:"Loading more posts..."})]})}export{me as default};
